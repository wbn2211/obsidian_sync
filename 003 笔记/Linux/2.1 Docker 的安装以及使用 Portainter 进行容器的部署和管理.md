# 2.1 Docker 的安装以及使用 Portainter 进行容器的部署和管理

---
tag:

#学习/电脑/linux/docker/portainter 

---
学习目标：

1. 学会使用命令部署 docker 以及容器
2. 部署 Portainter 并使用

---

>Linux 系统相关基础设置请参考 [[1.1 对 Linux 的初次设置相关]]

## 安装 docker

1. 首先进行系统的更新
```shell
sudo apt update
```

2. 更新索引，以支持 https
```shell
sudo apt-get install \

    ca-certificates \

    curl \

    gnupg \

    lsb-release
```

3. 添加 docker 官方 GPG 密钥
```shell
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
```

4. 设置 stable 版稳定存储库
```shell 
"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \

$(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

5. 更新存储库
```shell 
sudo apt update
```

6. 安装 docker
```shell
sudo apt-get install docker-ce docker-ce-cli containerd.io
```

7. 测试 docker 是否安装成功
```shell
sudo docker run hello-world
#显示 Hello from Docker! 即为安装成功
```

## Portainter 的安装

>本部分参考了b站up[科技宅小明]([科技宅小明的个人空间_哔哩哔哩_bilibili](https://space.bilibili.com/5626102?spm_id_from=333.337.0.0))的视频片段：[简单易学！手把手教你把一台垃圾电脑改成全能服务器！]( https://www.bilibili.com/video/BV1Bh411s765/?share_source=copy_web&vd_source=e4dd786ec48888d158c1a6642f6e8177)

1. 首先对 docker 服务器进行换源
```shell 
sudo vim /etc/docker/daemon.json
```
找到其中的 `registry-mirrors` 字段，如果没有就直接将下边文本的粘贴到文件内
```shell
{

 "registry-mirrors": ["https://registry.docker-cn.com"]

}
```
保存并退出

2. 重启 docker 服务并检测换源是否成功
```shell
service docker restart

docker info|grep "Registry Mirrors" -A 1
```
如果显示 `registry.docker-cn.com` 即换源成功

3. 创建 Portainter 存储数据库的卷
```shell
sudo docker volume create portainer_data
```

4. 安装 Portainter
```shell
sudo docker run -d -p 8000:8000 -p 9443:9443 --name portainer \

--restart=always \

-v /var/run/docker.sock:/var/run/docker.sock \

-v portainer_data:/data \

portainer/portainer-ce:latest
```

5. 测试 Portainter 是否安装成功
```shell
sudo docker ps
#出现 portainer/portainer-ce:latest 字样即为安装成功
```

6. 在浏览器的地址栏输入 `https://{IPaddress}:9443` 进入 Portainter 的管理界面

7. 进行管理员账户密码的设置

## 总结
docker 的安装是使用 Linux 的基础，在 docker 上可以出现更多的 Linux 的玩法，并且经过这几年的发展， docker 也出现了 docker-compose 这种更见易于上手的配置方式，

---
## 题外话
如果想在非 root 账户情况下使用 docker 指令可以参考 docker 官方手册中的这篇文章[Docker Engine post-installation steps | Docker Documentation](https://docs.docker.com/engine/install/linux-postinstall/)

