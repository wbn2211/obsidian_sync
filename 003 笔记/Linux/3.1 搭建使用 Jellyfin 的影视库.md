# 3.1 搭建使用 Jellyfin 的影视库

---
tag:

#学习/电脑/linux/docker/portainter #家庭影院 #学习/电脑/linux/docker/jellyfin

---
学习目标：

1. 学会在 web 配置 Jellyfin
2. 使用 `tmm` 进行刮削

---

## 开始安装（直接安装）

>系统相关配置部分详见 [[1.1 对 Linux 的初次设置相关]]

1. 如果没有 `curl` 和 `gnupg` 先进行安装
```shell
sudo apt install curl gnupg
```

2. 安装 apt 的 https 传输
```shell
sudo apt install apt-transport-https
# 有了就不需要了
```

3. 导入 GPG 签名密钥
```shell
wget -O - https://repo.jellyfin.org/ubuntu/jellyfin_team.gpg.key | sudo apt-key add -
```
4. 启用 `universe`
```shell
sudo add-apt-repository universe
# 获取所有FFMpeg依赖项
```

5. 添加源在`/etc/apt/sources.list.d/jellyfin.sources`
```shell
cat <<EOF | sudo tee /etc/apt/sources.list.d/jellyfin.sources
Types: deb
URIs: https://repo.jellyfin.org/$( awk -F'=' '/^ID=/{ print $NF }' /etc/os-release )
Suites: $( awk -F'=' '/^VERSION_CODENAME=/{ print $NF }' /etc/os-release )
Components: main
Architectures: $( dpkg --print-architecture )
Signed-By: /etc/apt/keyrings/jellyfin.gpg
EOF
```

6. 更新源
```shell
sudo apt update
```

7. 安装 Jellyfin
```shell
sudo apt install jellyfin
```

8. 管理你的 Jellyfin 系统服务
```shell
sudo service jellyfin status
sudo systemctl restart jellyfin
sudo /etc/init.d/jellyfin stop
```

## 安装（Docker）

### 使用 Portainter 安装 Jellyfin

>Portainter 以及 docker 相关参考 [[2.1 Docker 的安装以及使用 Portainter 进行容器的部署和管理]]

1. 拉取 Jellyfin 的镜像
![[Pasted image 20230130010130.png]]

2. 新建容器
	1. 在镜像栏中填入刚拉取镜像的 Tag 
	![[Pasted image 20230130011027.png]]
	
	 2. 将 docker 中的端口映射到本机的端口中
	 3. 设置存储数据库的卷
	 ![[Pasted image 20230130011724.png]]
		 在此步将自己的媒体存储卷映射到 docker 中，如果没有在 Portainter 中创建过 Volumes 请选择 Bind 选项，并在下边的 hosts 中填入主机路径
	 4. Click It!![[Pasted image 20230130012036.png]]

### 使用 docker 指令进行安装

安装指令为
```sh
docker run -d \
 --name jellyfin \
 --user uid:gid \
 --net=host \
 --volume /path/to/config:/config \ # Alternatively --volume jellyfin-config:/config
 --volume /path/to/cache:/cache \ # Alternatively --volume jellyfin-cache:/cache
 --mount type=bind,source=/path/to/media,target=/media \
 --restart=unless-stopped \
 jellyfin/jellyfin
```



## 使用 tmm 进行刮削

* 本步骤不是必须，相关操作也可以在 Jellyfin 中完成，只是作为 Jellyfin 刮削不成功时的替代

### 安装步骤

1. 在 tmm 官网下载 tmm 软件 [tinyMediaManager](https://www.tinymediamanager.org/)

> 下载自己对应平台的，本文以 Windows 平台为例


![[Pasted image 20230130121558.png]]

2. 打开 `C:/windows/system32/drivers/etc/` 路径，将其中的 hosts 文件复制一份备用

3. 使用管理员权限运行记事本或 VScode 打开 hosts 文件

4. 将以下内容复制到 hosts 文件中并保存
```
18.164.124.98 api.themoviedb.org
18.164.124.120 api.themoviedb.org
18.164.124.55 api.themoviedb.org 
18.164.124.75 api.themoviedb.org

143.244.50.87 image.tmdb.org
```

5. 将下载完成的文件解压到文件夹后，打开 `tinyMediaManager.exe` 文件

6. 设置相关的电影、电视剧的存储目录

7. 选中所有识别出的影片，选择自动匹配
![[Pasted image 20230130143445.png]]

8. 过一会匹配度高的会自动匹配完成

### 另

#### 文件的命名规范

使用 `tinyMediaManager` 搜索影片或电视剧需要校验剧集，所以规范的命名是很重要的，而且合理的对于影片的命名对于我们整理元数据时的帮助也是很大的。在此分享我使用的命名规范，仅供参考。

##### 对于电影

电影上我使用的是 `{电影名}(年份)` 的这种命名方式，将每个电影依此命名并放入对应的文件夹中，如 `闪灵 (1980) ` 、 `奇异博士2：疯狂多元宇宙 (2022)` 等
![[Pasted image 20230130144310.png]]

##### 对于电视剧

由于电视剧的信息很多，如上映年份、分级、季度等等信息，要与电影的命名方式进行匹配，所以我的命名方式是第一级文件夹是剧集和年份，如 `假面骑士Amazons (2016)` 、 `Arcane(2021)` 等；
![[Pasted image 20230130144929.png]]

第二级文件夹存放剧集的季度信息，如第一季则建立文件夹为 `S01` ，如果是特别篇则建立文件夹为 `S00` 以视为特别篇，如 `我的三体` 共有三季：第一季、罗辑传、章北海传，则命名为 `S01` 、 `S02` 、 `S03` 。
![[Pasted image 20230130145326.png]]

特别强调，对于只有一季的电视剧也要如此命名，如 `假面骑士空我` 只有第一季，也进行如上文所述的设置
![[Pasted image 20230130145628.png]]

## 配置 Jellyfin

出现如图所示的标志时，在浏览器的地址栏内输入 `https://{IPaddress}:8096` 进入 Jellyfin 的控制界面
![[Pasted image 20230130012406.png]]

1. 设置管理员账户密码等基础选项

2. 点击右上角的 **菜单** > **控制台** 进入管理界面
![[Pasted image 20230130115827.png]]

3. 在侧边栏中选择 **媒体库** ，进入媒体库管理界面
![[Pasted image 20230130115927.png]]

4. 选择 **添加媒体库** ，选择 **内容类别** 与 **显示名称** 并 **选择文件夹**

5. 添加完成后 Jellyfin 会自动扫描影视库信息，等待扫描完成即可观看视频
![[Pasted image 20230130153458.png]]